<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>shiyilibの博客</title>
  
  <subtitle>时间的线性是温柔的骗局</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://shiyilib.spicel.cn/"/>
  <updated>2020-07-08T15:09:05.489Z</updated>
  <id>http://shiyilib.spicel.cn/</id>
  
  <author>
    <name>shiyilib</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>mysql主从复制配置测试</title>
    <link href="http://shiyilib.spicel.cn/2020/06/15/202006151832/"/>
    <id>http://shiyilib.spicel.cn/2020/06/15/202006151832/</id>
    <published>2020-06-14T16:00:00.000Z</published>
    <updated>2020-07-08T15:09:05.489Z</updated>
    
    <content type="html"><![CDATA[<h1 id="MYSQL的主从复制配置"><a href="#MYSQL的主从复制配置" class="headerlink" title="MYSQL的主从复制配置"></a>MYSQL的主从复制配置</h1><a id="more"></a><h3 id="1-测试环境"><a href="#1-测试环境" class="headerlink" title="1 测试环境"></a>1 测试环境</h3><p><a href="https://www.cnblogs.com/songwenjie/p/9371422.html" target="_blank" rel="noopener">参考文档 https://www.cnblogs.com/songwenjie/p/9371422.html</a></p><p>centos7、mysql5.7.17、docker</p><h3 id="1-基于docker-安装mysql-主从库"><a href="#1-基于docker-安装mysql-主从库" class="headerlink" title="1 基于docker 安装mysql 主从库"></a>1 基于docker 安装mysql 主从库</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker #安装docker</span><br><span class="line"></span><br><span class="line">docker pull mysql:5.7.17 #拉取mysql镜像</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动主数据库容器</span></span><br><span class="line">docker <span class="builtin-name">run</span> -d --name mysql_master -p 3306:3306 -e <span class="attribute">MYSQL_ROOT_PASSWORD</span>=123456 mysql:5.7.17</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改容器内配置</span></span><br><span class="line">cd /etc/mysql</span><br><span class="line">vim my.cnf</span><br><span class="line"><span class="comment">#需要安装vim 执行</span></span><br><span class="line">apt-<span class="builtin-name">get</span><span class="built_in"> upgrade </span></span><br><span class="line">apt-<span class="builtin-name">get</span> update </span><br><span class="line"><span class="comment"># apt-key adv --keyserver pgp.mit.edu --recv-keys [key]</span></span><br><span class="line">apt-<span class="builtin-name">get</span> install vim</span><br><span class="line"></span><br><span class="line"><span class="comment">#在my.cnf 文件中添加如下</span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="attribute">service-id</span>=1</span><br><span class="line"><span class="attribute">log-bin</span>=mysql-bin</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改完成 重启服务及容器</span></span><br><span class="line"><span class="comment">#重复执行以上步骤建立从库 不同的是服务端口及my.cnf的配置稍微不同</span></span><br><span class="line"></span><br><span class="line">docker <span class="builtin-name">run</span> -d --name mysql_slave -p 3307:3306 -e <span class="attribute">MYSQL_ROOT_PASSWORD</span>=123456 mysql:5.7.17</span><br><span class="line"><span class="comment">#在my.cnf 文件中添加如下</span></span><br><span class="line">[mysqld]</span><br><span class="line"><span class="comment">## 设置server_id,注意要唯一</span></span><br><span class="line"><span class="attribute">server-id</span>=101  </span><br><span class="line"><span class="comment">## 开启二进制日志功能，以备Slave作为其它Slave的Master时使用</span></span><br><span class="line"><span class="attribute">log-bin</span>=mysql-slave-bin   </span><br><span class="line"><span class="comment">## relay_log配置中继日志</span></span><br><span class="line"><span class="attribute">relay_log</span>=edu-mysql-relay-bin</span><br></pre></td></tr></table></figure><h3 id="2-配置主从"><a href="#2-配置主从" class="headerlink" title="2 配置主从"></a>2 配置主从</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#主库容器</span></span><br><span class="line">docker exec -it &#123;container-id&#125; /bin/bash</span><br><span class="line"></span><br><span class="line">mysql -uroot -p123456</span><br><span class="line"></span><br><span class="line">show master status; 记录结果集中的file position字段的值</span><br><span class="line"></span><br><span class="line"><span class="comment">#查询主库容器独立ip</span></span><br><span class="line">docker inspect <span class="attribute">--format</span>=<span class="string">'&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;'</span> [container-id|container-name]</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入从库容器</span></span><br><span class="line">mysql -uroot -p123456</span><br><span class="line"></span><br><span class="line"><span class="comment">#在slave中执行</span></span><br><span class="line">change master <span class="keyword">to</span> <span class="attribute">master_host</span>=<span class="string">'&#123;docker-ip&#125;'</span>, <span class="attribute">master_user</span>=<span class="string">'&#123;username&#125;'</span>, <span class="attribute">master_password</span>=<span class="string">'&#123;pw&#125;'</span>, master_port=&#123;port&#125;, <span class="attribute">master_log_file</span>=<span class="string">'&#123;log&#125;'</span>, master_log_pos= &#123;position&#125;, <span class="attribute">master_connect_retry</span>=30;</span><br><span class="line"></span><br><span class="line">在Slave 中的mysql终端执行show slave status \G;用于查看主从同步状态。</span><br><span class="line"></span><br><span class="line">正常情况下，SlaveIORunning 和 SlaveSQLRunning 都是<span class="literal">No</span>，因为我们还没有开启主从复制过程。使用start slave开启主从复制过程，然后再次查询主从同步状态show slave status \G;。</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>在主库中建立新库 对应从库也会添加相应的库 </p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;MYSQL的主从复制配置&quot;&gt;&lt;a href=&quot;#MYSQL的主从复制配置&quot; class=&quot;headerlink&quot; title=&quot;MYSQL的主从复制配置&quot;&gt;&lt;/a&gt;MYSQL的主从复制配置&lt;/h1&gt;
    
    </summary>
    
    
      <category term="mysql" scheme="http://shiyilib.spicel.cn/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://shiyilib.spicel.cn/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>IDEA 2019.3.5及DataGrip破解(软件版本2020.1) 破解</title>
    <link href="http://shiyilib.spicel.cn/2020/06/15/202006231923/"/>
    <id>http://shiyilib.spicel.cn/2020/06/15/202006231923/</id>
    <published>2020-06-14T16:00:00.000Z</published>
    <updated>2020-07-08T15:29:54.683Z</updated>
    
    <content type="html"><![CDATA[<h1 id="1-IDEA-2019-3-5-破解"><a href="#1-IDEA-2019-3-5-破解" class="headerlink" title="1. IDEA 2019.3.5 破解"></a>1. IDEA 2019.3.5 破解</h1><a id="more"></a><p>1.1  初始化工作：到官网下载idea安装包 <a href="https://www.jetbrains.com/idea/download/other.html" target="_blank" rel="noopener">版本选择</a><br>下载完成后进行安装</p><p>1.2  下载对应的破解包 链接：<a href="https://pan.baidu.com/s/1hYy0x8pclsRUM4cKqNWZEw" target="_blank" rel="noopener">https://pan.baidu.com/s/1hYy0x8pclsRUM4cKqNWZEw</a><br>提取码：9t8e</p><p>1.3  完成安装后，初次使用选择试用30天，通过选择edit custom VM options 添加破解jar的路径<br>    <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">-javaagent</span><span class="selector-pseudo">:D</span>:\<span class="selector-tag">jetbrains-agent</span><span class="selector-class">.jar</span></span><br></pre></td></tr></table></figure></p><p>1.4  破解包中除了jar包之外还有一个important.txt文件，需要将该文件与jar置于同一目录下</p><h1 id="2-DataGrip破解-软件版本2020-1"><a href="#2-DataGrip破解-软件版本2020-1" class="headerlink" title="2. DataGrip破解(软件版本2020.1)"></a>2. DataGrip破解(软件版本2020.1)</h1><p>2.1 与idea破解类似 下载对应的软件包与破解包<br><a href="https://pan.baidu.com/s/1ixcbkPjff1Z3_ZqJ0G6VcA" target="_blank" rel="noopener">https://pan.baidu.com/s/1ixcbkPjff1Z3_ZqJ0G6VcA</a><br>提取码：6uso<br>该压缩包包含dataGrip安装文件及破解jar以及不完全汉化包</p><p>2.2 安装完成之后，选择试用，进入crack文件夹解压jetbrains-agent-latest.zip压缩文件得到破解补丁，并将lib文件夹中的jetbrains-agent.jar拖动到软件内，之后重启，重启后弹出激活提示，选择激活方式为activation Code 完成后重启软件即可。</p><p>2.3 汉化包的使用：将resources_zh_CN_DataGrip_2020_r1.jar汉化补丁包复制到软件安装路径lib文件下即可。</p>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;1-IDEA-2019-3-5-破解&quot;&gt;&lt;a href=&quot;#1-IDEA-2019-3-5-破解&quot; class=&quot;headerlink&quot; title=&quot;1. IDEA 2019.3.5 破解&quot;&gt;&lt;/a&gt;1. IDEA 2019.3.5 破解&lt;/h1&gt;
    
    </summary>
    
    
      <category term="IDEA" scheme="http://shiyilib.spicel.cn/categories/IDEA/"/>
    
    
      <category term="IDEA" scheme="http://shiyilib.spicel.cn/tags/IDEA/"/>
    
  </entry>
  
  <entry>
    <title>解决Navicat连接数据库错误--2059</title>
    <link href="http://shiyilib.spicel.cn/2019/11/07/201911072213/"/>
    <id>http://shiyilib.spicel.cn/2019/11/07/201911072213/</id>
    <published>2019-11-06T16:00:00.000Z</published>
    <updated>2020-07-08T15:29:22.197Z</updated>
    
    <content type="html"><![CDATA[<p><img src="navicat-mysql-2059.png" alt=""></p><h6 id="数据库版本-——8-0-18-（select-version-）"><a href="#数据库版本-——8-0-18-（select-version-）" class="headerlink" title="数据库版本 ——8.0.18 （select version()）"></a>数据库版本 ——8.0.18 （<code>select version()</code>）</h6><a id="more"></a><h5 id="原因："><a href="#原因：" class="headerlink" title="原因："></a>原因：</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql8之前的版本的加密规则是mysql_native_password，在mysql8之后，加密规则变成了caching_sha2_password</span><br></pre></td></tr></table></figure><h5 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#更改加密规则</span><br><span class="line">mysql -uroot -ppassword #登录</span><br><span class="line">#选择mysql库</span><br><span class="line">use mysql;</span><br><span class="line">#远程连接将&apos;localhost&apos;换成&apos;%&apos;</span><br><span class="line">#更改加密方式</span><br><span class="line">ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;password&apos; PASSWORD EXPIRE NEVER; </span><br><span class="line">#更新用户密码</span><br><span class="line">ALTER USER &apos;root&apos;@&apos;localhost&apos; IDENTIFIED WITH mysql_native_password BY &apos;password&apos;; </span><br><span class="line">#刷新权限</span><br><span class="line">FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><h5 id="mysql-如何修改root密码"><a href="#mysql-如何修改root密码" class="headerlink" title="mysql 如何修改root密码"></a>mysql 如何修改root密码</h5><h6 id="一、用set-password命令"><a href="#一、用set-password命令" class="headerlink" title="一、用set password命令"></a>一、用set password命令</h6><ul><li>eg： mysql&gt; set password for 用户名@localhost = password(‘新密码’);</li><li>mysql8:ALTER USER ‘root’@’%’ IDENTIFIED WITH mysql_native_password BY’<code>password</code>‘;</li></ul><h6 id="二、用mysqladmin"><a href="#二、用mysqladmin" class="headerlink" title="二、用mysqladmin"></a>二、用<strong>mysqladmin</strong></h6><ul><li>eg：mysqladmin -u用户名 -p旧密码 password 新密码 ；</li></ul><h6 id="三、直接update-mysql库中的User表"><a href="#三、直接update-mysql库中的User表" class="headerlink" title="三、直接update mysql库中的User表"></a>三、直接update mysql库中的User表</h6><ul><li><p>mysql&gt; use mysql; update user set password=password(‘123’) where user=’root’ and host=’localhost’; </p></li><li><p>flush privileges; </p></li></ul><h6 id="四、忘记root密码时"><a href="#四、忘记root密码时" class="headerlink" title="四、忘记root密码时"></a>四、忘记root密码时</h6><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">以windows为例：</span><br><span class="line">1. 关闭正在运行的MySQL服务。 </span><br><span class="line">2. 打开DOS窗口，转到mysql\bin目录。 </span><br><span class="line">3. 输入mysqld --skip-grant-tables//--skip-grant-tables 的意思是启动MySQL服务的时候跳过权限表认证。 </span><br><span class="line">4. 再开一个DOS窗口（因为刚才那个DOS窗口已经不能动了），转到mysql\bin目录。 </span><br><span class="line">5. 输入mysql回车，如果成功，将出现MySQL提示符 &gt;。 </span><br><span class="line">6. 连接权限数据库： use mysql; 。 </span><br><span class="line">7. 改密码：update user set password=password("123") where user="root";（别忘了最后加分号） 。 </span><br><span class="line">8. 刷新权限（必须步骤）：flush privileges;　。 </span><br><span class="line">9. 退出 quit。 </span><br><span class="line">10. 注销系统，再进入，使用用户名root和刚才设置的新密码123登录。</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;navicat-mysql-2059.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;h6 id=&quot;数据库版本-——8-0-18-（select-version-）&quot;&gt;&lt;a href=&quot;#数据库版本-——8-0-18-（select-version-）&quot; class=&quot;headerlink&quot; title=&quot;数据库版本 ——8.0.18 （select version()）&quot;&gt;&lt;/a&gt;数据库版本 ——8.0.18 （&lt;code&gt;select version()&lt;/code&gt;）&lt;/h6&gt;
    
    </summary>
    
    
      <category term="mysql" scheme="http://shiyilib.spicel.cn/categories/mysql/"/>
    
    
      <category term="mysql" scheme="http://shiyilib.spicel.cn/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>自定义连接池</title>
    <link href="http://shiyilib.spicel.cn/2019/07/20/201907280937/"/>
    <id>http://shiyilib.spicel.cn/2019/07/20/201907280937/</id>
    <published>2019-07-19T16:00:00.000Z</published>
    <updated>2020-07-08T15:28:46.065Z</updated>
    
    <content type="html"><![CDATA[<h5 id="自定义连接池"><a href="#自定义连接池" class="headerlink" title="自定义连接池"></a>自定义连接池</h5><a id="more"></a><ol><li><p>自定义Connection implements java.sql.connection</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConn</span> <span class="title">implemnets</span> <span class="title">Connection</span></span>&#123;</span><br><span class="line"><span class="comment">//定义一个变量</span></span><br><span class="line"><span class="keyword">private</span> Connection conn;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> LinkedList&lt;Connection&gt; pool;</span><br><span class="line"></span><br><span class="line"><span class="comment">//构造函数</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">MyConn</span><span class="params">(Connection conn,LinkedList&lt;Connection&gt; pool)</span></span>&#123;</span><br><span class="line"><span class="keyword">this</span>.conn = conn;</span><br><span class="line"><span class="keyword">this</span>.pool = pool;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//增强方法</span></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">pool.add(conn);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//覆盖prepareStatement方法； 此方法必须重写，否则会出现空指针</span></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PrepareStatement <span class="title">prepareStatement</span><span class="params">(String sql)</span> <span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line"><span class="keyword">return</span> conn.prepareStatement(sql);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/***</span></span><br><span class="line"><span class="comment">..... other overrides methods</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>自定义dataSource implements javax.sql.DataSource</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDataSource</span> <span class="keyword">implements</span> <span class="title">DataSource</span></span>&#123;</span><br><span class="line"><span class="comment">//创建容器存储connection对象</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> LinkedList&lt;Connection&gt; pool = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"><span class="comment">//创建多个连接放到容器中</span></span><br><span class="line"><span class="keyword">static</span>&#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">Connection conn = JDBCUtils.getConnection();</span><br><span class="line"><span class="comment">//将改造后conn放到池中</span></span><br><span class="line">MyConn myConn = <span class="keyword">new</span> MyConn(conn,pool);</span><br><span class="line">pool.add(myConn);</span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 重写获取连接的方法</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Connection <span class="title">getConnection</span><span class="params">()</span> <span class="keyword">throws</span> SQLException</span>&#123;</span><br><span class="line">Connection conn = <span class="keyword">null</span>;</span><br><span class="line"><span class="comment">//使用前判断</span></span><br><span class="line"><span class="keyword">if</span>(pool.size() == <span class="number">0</span>)&#123;</span><br><span class="line"><span class="comment">//若池中没有，就再次创建</span></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt; <span class="number">10</span>; i++)&#123;</span><br><span class="line">Connection conn = JDBCUtils.getConnection();</span><br><span class="line"><span class="comment">//将改造后conn放到池中</span></span><br><span class="line">MyConn myConn = <span class="keyword">new</span> MyConn(conn,pool);</span><br><span class="line">pool.add(myConn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//若池中连接不为空</span></span><br><span class="line">conn = pool.remove(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">return</span> conn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 归还连接对象到池中</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="meta">@override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backConnection</span><span class="params">(Connection conn)</span></span>&#123;</span><br><span class="line">pool.add(conn)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">other implements methods</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>JDBCUtils工具类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取连接和释放资源</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JDBCUtil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String driver;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String url;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态代码块加载配置</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">   <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 1.通过当前类获取类加载器</span></span><br><span class="line">            ClassLoader classLoader = JDBCUtil<span class="class">.<span class="keyword">class</span>.<span class="title">getClassLoader</span>()</span>;</span><br><span class="line">            <span class="comment">// 2.通过类加载器的方法获得一个输入流</span></span><br><span class="line">            InputStream is = classLoader.getResourceAsStream(<span class="string">"db.properties"</span>);</span><br><span class="line">            <span class="comment">// 3.创建一个properties对象</span></span><br><span class="line">            Properties props = <span class="keyword">new</span> Properties();</span><br><span class="line">            <span class="comment">// 4.加载输入流</span></span><br><span class="line">            props.load(is);</span><br><span class="line">            <span class="comment">// 5.获取相关参数的值</span></span><br><span class="line">            driver = props.getProperty(<span class="string">"driver"</span>);</span><br><span class="line">            url = props.getProperty(<span class="string">"url"</span>);</span><br><span class="line">            username = props.getProperty(<span class="string">"username"</span>);</span><br><span class="line">            password = props.getProperty(<span class="string">"password"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取连接</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title">getConnection</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Connection conn = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Class.forName(driver);</span><br><span class="line">            conn = DriverManager.getConnection(url, username, password);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> conn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 释放资源</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> conn</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> pstmt</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> rs</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">release</span><span class="params">(Connection conn, PreparedStatement pstmt, ResultSet rs)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (rs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                rs.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (pstmt != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                pstmt.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (conn != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                conn.close();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h5 id=&quot;自定义连接池&quot;&gt;&lt;a href=&quot;#自定义连接池&quot; class=&quot;headerlink&quot; title=&quot;自定义连接池&quot;&gt;&lt;/a&gt;自定义连接池&lt;/h5&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://shiyilib.spicel.cn/categories/Java/"/>
    
    
      <category term="Utils" scheme="http://shiyilib.spicel.cn/tags/Utils/"/>
    
      <category term="Java" scheme="http://shiyilib.spicel.cn/tags/Java/"/>
    
      <category term="JDBC" scheme="http://shiyilib.spicel.cn/tags/JDBC/"/>
    
  </entry>
  
</feed>
